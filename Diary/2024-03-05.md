# 任务规划
- [ ] 
  
  
  
  一句一句读论文！！！
摘要
提出一种系统完成自由形式掩码和草图的图像修复，系统基于不需要额外标记的门控卷积。这种门控卷积解决了普通卷积（将所有输入像素作为有效像素），将在所有层的每个空间位置的每个通道提供可学习的动态特征选择机制来推广部分卷积。由于自由形式掩盖可能以任何形状出现在任何位置，为单个矩形掩模设计的全局和局部Gan不适用。还提出了基于补丁的GAN损失——SN-PatchGAN（计算快速稳定），通过在密集图像块上应用光谱归一化鉴别器。可用于消除分散注意力的特征，修改图像布局，清除水印和编辑人脸。 
引言
图像修复（图像复原、图像孔洞填充）是在缺失部分合成可替代的内容以便修改视觉上的真实性和达到语义正确。它还可以扩展到包括图像/视频裁剪、定位、缝合、重新定位、重新合成、压缩、超分辨率、协调和许多其他任务。
在计算机视觉中，有两种图像修复方法：
    1.使用低级图像特征的补丁块匹配   可以合成合理的固定纹理，但通常在非平稳情况下（例如复杂的场景，面部和物体）会造成严重的失效
     2.有深度卷积网络的前馈生成模型   可以利用从大规模数据集中学习到的语义，以端到端的方式合成非平稳图像中的内容。
基于原始卷积的深度生成模型不适用于图像孔填充，会把输入像素全作为有效像素。对于孔填充，每层的输入均由空外部的有效像素和区域内的无效像素组成，传统卷积在所有的有效，无效，混合像素上均运用相同的滤波器，导致在不规则掩码上测试时出现视觉伪像，如色差，模糊度和孔边缘出现的明显响应。
为解决这一局限性，最近提出部分卷积，其中，卷积被掩盖并归一化为只以有效像素为条件，然后是基于规则掩码的更新步骤，在下一层更新有效的位置。部分卷积将所有输入位置分为无效或有效，并将零或一掩码乘以所有层输入。这个掩码也可以视为单个不可学习的特征门控通道。但这种假设有几个局限性：
     1.考虑跨网络不同层的输入空间位置包括：输入图像中的有效像素，输入图像中的掩码像素，具有接受域的神经元没有覆盖输入图像的有效像素，具有接受场的神经元覆盖了输入图像的不同数量的有效像素，网络深层中的合成像素。
     2.如果用户在掩码内提供了稀疏草图，这些像素应该被视为有效还是无效？如何更新下一层掩码？
     3.对于部分卷积，“无效”像素会逐层消失，使用全1掩码进行部分卷积提供的信息不完全。
将证明，如果我们允许网络自动学习掩码，则根据输入图像中甚至在深层中当前位置是否被遮挡，掩码可能会具有不同的值。
提出门控卷积用于不规则掩码的图像修复。它为每个通道和每个空间位置（内部或外部掩码，RGB通道或用户指导通道）学习动态特征门控机制。
  使用输入特征来计算门控值：![g =\sigma（w_g\times x）](https://math.jianshu.com/math?formula=g%20%3D%5Csigma%EF%BC%88w_g%5Ctimes%20x%EF%BC%89)（![\sigma](https://math.jianshu.com/math?formula=%5Csigma)是sigmoid函数，![w_g](https://math.jianshu.com/math?formula=w_g)是可学习的参数）
  输出是学习到的特征与门控值![y =\phi（wx）\odot g](https://math.jianshu.com/math?formula=y%20%3D%5Cphi%EF%BC%88wx%EF%BC%89%5Codot%20g)的乘积，其中![\phi](https://math.jianshu.com/math?formula=%5Cphi)可以是任何激活函数。当蒙版具有任意形状，并且输入不再仅仅是带蒙版的RGB通道，而是具有条件输入（如稀疏草图）时，门控卷积易于实现，并且性能更好。对于网络体系结构，我们根据堆叠门控卷积以及形成编码器-解码器网络。我们的修复网络也将上下文关注模块集成到同一优化网络中，以更好地捕获远距离依赖关系。
  在不影响性能的情况下，作者将训练目标简化为两个术语：像素级重建损失和对抗损失。该修改主要用于不规则的图像修复。由于缺失空洞可能会出现以任何形状出现在图像中的任何位置，因此为单个举行掩码设计的全局和局部GAN方法并不适用。相反，我们提出了一种生成对抗网络的变体，称为SN-PatchGAN，受全局和局部GAN，MarkovianGAN，感知损失和频谱归一化GAN启发。SN-PatchGAN的判别器直接以格式![\mathbb{R}^{h\times w\times c}](https://math.jianshu.com/math?formula=%5Cmathbb%7BR%7D%5E%7Bh%5Ctimes%20w%5Ctimes%20c%7D)计算输出映射图每个点上的铰链hinge损失，并用![h\times w\times c](https://math.jianshu.com/math?formula=h%5Ctimes%20w%5Ctimes%20c)数量的GAN表示不同位置和不同语义（在不同通道中表示）的数量。 SN-PatchGAN形式简单，训练快速稳定，可产生高质量的修补效果。
  对于实用的图像修复工具，允许用户交互性至关重要，因为这可以存在许多可行的解决方案来填充图像中的孔洞。为此，我们提出了一个扩展，以允许用户草图作为引导输入。主要贡献如下：
     1.引入门控卷积，以学习跨所有层的每个空间位置处每个通道的动态特征选择机制，从而提高了颜色一致性和不规则掩码输入的图像修复质量。
     2.提出了一种更实用的基于补丁块的GAN鉴别器SN-PatchGAN，用于不规则的图像修复。简单快速并且可以产生高质量的修复效果。
     3.我们将修复模型扩展到一种交互模型，以用户草图为指导来获得更多用户期望的修复结果
     4.我们提出的修复系统在基准数据集（包括Places2自然场景和CelebA-HQ人脸）上实现了比现有技术更高质量的自由形式修复。我们证明了所提出的系统可以帮助用户快速去除干扰物体，修改图像布局，清除水印并编辑图像中的人脸。
    不同方法的比较包括PatchMatch，Global&Local，ContextAttention，PartialConv以及本文的方法。图像修复的比较是基于四个维度的：语义理解，非局部算法，不规则掩码和用户指导可选。
     ![[../Pasted image 20240306153929.png]]
相关工作
自动图像修复
传统上，基于图像块的算法会基于低级特征（例如RGB空间上的均方差特征）逐行扩展接近孔边界的像素，以搜索并粘贴最相似的图像块。这些算法在静止的纹理区域上效果很好，但在非静止的图像上常常失效。此外，Simakov等人提出了双向相似性合成的方法，以更好地捕获和总结非平稳视觉数据。为了减少搜索过程中存储和计算的高成本，提出了基于树的存储加速结构和随机算法。此外，通过匹配局部特征可以改善修复效果，例如图像梯度]和相似块的偏移量统计信息。近来，提出了基于深度学习的图像修复系统以直接预测掩码内的像素值。这些模型的显着优势是能够学习针对不同语义的自适应图像特征。因此，它们可以合成更直观的内容，尤其是对于像脸部，物体和自然场景之类的图像。在所有这些方法中，Iizuka等人提出了一种具有全局和局部一致性的全卷积图像修复网络，以处理各种数据集上的高分辨率图像。但是，这种方法仍然在很大程度上依赖于Poisson图像融合与基于修补程序的传统修补结果。 Yu等人提出了一种端到端的图像修复模型，该模型采用堆叠的生成网络来进一步确保生成区域与周围环境的颜色和纹理一致性。此外，为了捕获远距离依赖性，提出了上下文注意模块，并将其集成到网络中以明确地借用来自较远空间位置的信息。但是，这种方法主要是在大型矩形掩码上训练的，在自由形式的蒙版上不能很好地推广。为了更好地处理不规则的掩码，提出了部分卷积，其中卷积被遮挡并重新归一化以仅利用有效像素。紧接着是基于规则的掩码更新步骤，以逐层重新计算新的掩码。
引导图像修复与合成
为改善图像修复，用户指导方法正在被探索，包括点或线，结构，变换或失真信息和图像示例。值得注意的是，Hays和Efros ]首先利用数百万张照片作为数据库来搜索与输入最相似的示例图像，然后通过从匹配图像中剪切和粘贴相应区域来完成图像。  
条件生成网络的最新进展使从大规模数据集学习到的用户指导图像处理，合成和处理成为可能。在这里，我们选择性地回顾了一些相关的工作。张等人 提出了可以将用户指导作为附加输入的着色网络。 王等人提出使用条件生成对抗网络从语义标签图合成高分辨率的真实感图像。 Scribbler探索了一个基于草图边界和稀疏颜色笔画的深层生成网络，以合成汽车、卧室或人脸。
特征级门控
在视频，语，语音和许多其他任务中，已经广泛探索了基于特征的门控。 例如，Highways网络利用特征门控来简化基于梯度的非常深层网络训练。 Squeeze-and-Excitation网络通过将每个通道与学习的Sigmoid型门控值相乘来重新校准特征响应。 WaveNets 通过使用一个特殊特征门![y = \tanh（w_1\times x）\cdot Sigmoid（w_2\times x）](https://math.jianshu.com/math?formula=y%20%3D%20%5Ctanh%EF%BC%88w_1%5Ctimes%20x%EF%BC%89%5Ccdot%20Sigmoid%EF%BC%88w_2%5Ctimes%20x%EF%BC%89)来对音频信号建模来获得更好的结果。

### 门控卷积

首先解释为什么[15，49]中使用的原始传统卷积不适用于不规则的图像修补任务。 考虑一个卷积层，其中将一组滤波器应用于输入特征图得到输出。 假设输入是C通道，则在C′通道输出图中位于(y,x)的每个像素的计算方式如下：  
![O_{y,x} = \sum_{i=k_h^\prime}^{k_h^\prime}\sum_{i=k_w^\prime}^{k_w^\prime}W_{k_h^\prime+i,k_w^\prime+j}\cdot I_{y+i,x+j}](https://math.jianshu.com/math?formula=O_%7By%2Cx%7D%20%3D%20%5Csum_%7Bi%3Dk_h%5E%5Cprime%7D%5E%7Bk_h%5E%5Cprime%7D%5Csum_%7Bi%3Dk_w%5E%5Cprime%7D%5E%7Bk_w%5E%5Cprime%7DW_%7Bk_h%5E%5Cprime%2Bi%2Ck_w%5E%5Cprime%2Bj%7D%5Ccdot%20I_%7By%2Bi%2Cx%2Bj%7D)  
其中x,y代表输出特征图的x轴和y轴，![k_w](https://math.jianshu.com/math?formula=k_w)和![k_h](https://math.jianshu.com/math?formula=k_h)是卷积核大小比如![3\times 3](https://math.jianshu.com/math?formula=3%5Ctimes%203)，![k_h^\prime = \frac{k_h-1}{2},k_w^\prime = \frac{k_w-1}{2},W\in\mathbb{R}^{k_h\times k_w\times C\times C'}](https://math.jianshu.com/math?formula=k_h%5E%5Cprime%20%3D%20%5Cfrac%7Bk_h-1%7D%7B2%7D%2Ck_w%5E%5Cprime%20%3D%20%5Cfrac%7Bk_w-1%7D%7B2%7D%2CW%5Cin%5Cmathbb%7BR%7D%5E%7Bk_h%5Ctimes%20k_w%5Ctimes%20C%5Ctimes%20C'%7D)代表卷积滤波器，![I_{y+i,x+j}\in \mathbb{R}^C](https://math.jianshu.com/math?formula=I_%7By%2Bi%2Cx%2Bj%7D%5Cin%20%5Cmathbb%7BR%7D%5EC)和![O_{y,x}\in \mathbb{R}^{C'}](https://math.jianshu.com/math?formula=O_%7By%2Cx%7D%5Cin%20%5Cmathbb%7BR%7D%5E%7BC'%7D)分别代表输入和输出。为简化，省略偏置项。  
该方程式表明，对于所有空间位置（y，x），都应用相同的滤波器以产生原始卷积层中的输出。 这对于诸如图像分类和对象检测（其中输入图像的所有像素均有效）之类的任务有意义，以滑动窗口的方式提取局部特征。 但是，对于图像修复，输入由在孔外具有有效像素/特征和在掩蔽区域中具有无效像素/特征（在浅层中）或合成像素/特征（在深层中）的两个区域组成。 如[23]中报道的那样，这会在训练过程中引起歧义，并导致视觉伪影，例如颜色差异，模糊和明显的边缘响应。  
最近提出的部分卷积[23]采用了遮挡掩码和重新归一化的步骤，使卷积仅依赖于有效的像素如下式：  
![O_{y,x}=\sum \sum W \cdot (I\odot\frac{M}{sum(M)}) \quad if \quad sum(M)>0](https://math.jianshu.com/math?formula=O_%7By%2Cx%7D%3D%5Csum%20%5Csum%20W%20%5Ccdot%20(I%5Codot%5Cfrac%7BM%7D%7Bsum(M)%7D)%20%5Cquad%20if%20%5Cquad%20sum(M)%3E0)  
其中M是对应的二进制掩码，1表示位置（y，x）上的像素有效，0表示像素无效，⊙表示逐元素乘法。 在每个部分卷积运算之后，需要使用掩码更新步骤来传播具有以下规则的新M：![m'_{y,x} = 1](https://math.jianshu.com/math?formula=m'_%7By%2Cx%7D%20%3D%201)，当sum（M）> 0时。  
部分卷积[23]提高了在不规则掩码上的修补质量，但仍然存在以下问题：（1）启发式地将所有空间位置分类为有效或无效。无论上一层滤波器范围覆盖多少像素，下一层的遮罩都将被设置为一个（例如，更新当前掩码时将1个有效像素和9个有效像素视为相同）。 （2）它与额外用户输入不兼容。我们针对的是用户指导的图像修复系统，用户可以选择在掩码中提供稀疏草图作为条件通道。在这种情况下，应将这些像素位置视为有效还是无效？如何正确更新下一层的掩码？ （3）对于部分卷积，无效像素将在深层逐渐消失，将所有掩码值逐渐转换为1。但是，我们的研究表明，如果允许网络自动学习最佳掩码，则网络甚至会在较深的层中为每个空间位置分配软掩码值。 （4）每层中的所有通道共享相同的掩码，这限制了灵活性。本质上，部分卷积可以看作是难以学习的单通道特征固定门控。  
作者提出门控卷积用于图像修复网络如图2所示。门控卷积不是使用规则更新固定的掩码，而是自动从数据中学习软掩码。 公式为：  
![Gating_{y,x}=\sum\sum W_g \cdot I](https://math.jianshu.com/math?formula=Gating_%7By%2Cx%7D%3D%5Csum%5Csum%20W_g%20%5Ccdot%20I)  
![Feature_{y,x}=\sum\sum W_f \cdot I](https://math.jianshu.com/math?formula=Feature_%7By%2Cx%7D%3D%5Csum%5Csum%20W_f%20%5Ccdot%20I)  
![O_{y,x}=\phi(Feature_{y,x})\cdot \sigma (Gating_{y,x})](https://math.jianshu.com/math?formula=O_%7By%2Cx%7D%3D%5Cphi(Feature_%7By%2Cx%7D)%5Ccdot%20%5Csigma%20(Gating_%7By%2Cx%7D))  
其中![\sigma](https://math.jianshu.com/math?formula=%5Csigma)是sigmoid函数，因此输出门值在0和1之间，![\phi](https://math.jianshu.com/math?formula=%5Cphi)可以是任意激活函数如ReLU,ELU和LeakyReLU。![W_g](https://math.jianshu.com/math?formula=W_g)和![W_f](https://math.jianshu.com/math?formula=W_f)是两个不同的卷积滤波器。

  
  

  
  

  










# 预期结果

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

# bottom